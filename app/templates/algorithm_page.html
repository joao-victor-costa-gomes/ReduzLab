{% extends "base.html" %}

{% block content %}

    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Switch Algorithm</h5>
            <p class="card-text text-muted">Quickly switch to another algorithm using the same uploaded dataset.</p>
            <ul class="nav nav-pills nav-fill">
                <li class="nav-item">
                    <a class="nav-link {% if algorithm_name == 'PCA' %}active{% endif %}" href="{{ url_for('main.pca_page') }}">PCA</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if algorithm_name == 'T-SNE' %}active{% endif %}" href="{{ url_for('main.tsne_page') }}">T-SNE</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if algorithm_name == 'NCA' %}active{% endif %}" href="{{ url_for('main.nca_page') }}">NCA</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if algorithm_name == 'LLE' %}active{% endif %}" href="{{ url_for('main.lle_page') }}">LLE</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if algorithm_name == 'LDA' %}active{% endif %}" href="{{ url_for('main.lda_page') }}">LDA</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if algorithm_name == 'KPCA' %}active{% endif %}" href="{{ url_for('main.kpca_page') }}">KPCA</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if algorithm_name == 'Isomap' %}active{% endif %}" href="{{ url_for('main.isomap_page') }}">Isomap</a>
                </li>
            </ul>
        </div>
    </div>

    <h1 class="mb-4">{{ algorithm_name }} Algorithm</h1>

    <div class="card mb-4">
        <div class="card-header">
            <h2>Data Preview & Validation Report</h2>
        </div>
        <div class="card-body">
            {% if table_html %}
                
                <!-- preview feedback -->
                {% if preview_error %}
                    <div class="alert alert-danger" role="alert">{{ preview_error }}</div>
                {% endif %}
                {% if preview_success %}
                    <div class="alert alert-success" role="alert">{{ preview_success }}</div>
                {% endif %}

                <!-- column data type alert --> 
                {% if validation_results and (validation_results.non_numeric_cols or validation_results.null_info) %}
                    <div class="alert alert-warning" role="alert">
                        <h4 class="alert-heading">⚠️ Validation Report</h4>
                        <p>Please review the following issues before proceeding. Algorithms may fail with non-numeric or missing data.</p>
                        <hr>
                        {% if validation_results.non_numeric_cols %}
                            <p class="mb-1"><strong>Non-Numeric Columns Found:</strong></p>
                            <ul>
                                {% for col in validation_results.non_numeric_cols %}
                                    <li>{{ col }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                        {% if validation_results.null_info %}
                            <p class="mb-1"><strong>Columns with Missing Values:</strong></p>
                            <ul>
                                {% for col, count in validation_results.null_info.items() %}
                                    <li>{{ col }} ({{ count }} missing)</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                {% endif %}
                
                <!-- preview data --> 
                <div class="table-responsive">
                    {{ table_html | safe }}
                </div>
            
            {% else %}

                <!-- preview load error --> 
                <div class="alert alert-danger" role="alert">
                    Could not load data preview. Please <a href="{{ url_for('main.index_page') }}" class="alert-link">upload a file</a> first.
                </div>

            {% endif %}
        </div>
    </div>
    
    <!-- algorithm page content --> 
    {% block algorithm_content %}
    {% endblock %}

{% endblock %}