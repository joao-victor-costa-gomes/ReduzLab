{% extends "algorithm_page.html" %}

{% from '_macros.html' import base_parameters_form %}

{% block algorithm_content %}
<section>
    <h2>Configure PCA Parameters</h2>

    <form method="POST">
        <!-- all base parameters forms -->
        {{ base_parameters_form(column_options, form_data) }}

        <hr>

        <button type="submit">Run PCA</button>

        <!-- parameters errors -->
        {% if param_error %}
            <p style="color: red;">{{ param_error }}</p>
        {% endif %}
    </form>

    {% if plot_url %}
    <hr>
    <section class="results">
        <h2>Results</h2>

        {% if metrics %}
            <h4>Metrics:</h4>
            <ul>
                {% for key, value in metrics.items() %}
                    <li><strong>{{ key }}:</strong> {{ value }}</li>
                {% endfor %}
            </ul>
        {% endif %}

        <h4>Plot:</h4>
        {% if 'html' in plot_url %}
            <iframe src="{{ plot_url }}" width="100%" height="600px" style="border: none;"></iframe>
        {% else %}
            <img src="{{ plot_url }}" alt="PCA Plot" style="max-width: 100%; height: auto;">
        {% endif %}
        
        <br>
        <a href="{{ plot_url }}" download>Download Plot</a>

        {% if csv_url %}
            <br>
            <a href="{{ csv_url }}" download>Download Reduced Data (CSV)</a>
        {% endif %}
    </section>
    {% endif %}

</section>
{% endblock %}