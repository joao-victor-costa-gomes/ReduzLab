{% extends "algorithm_page.html" %}

{% from '_base_parameters.html' import base_parameters_form %}

{% block algorithm_content %}

    <div class="card">
        <div class="card-header">
            <h2>Configure NCA Parameters</h2>
        </div>
        <div class="card-body">
            <form method="POST" onsubmit="showLoadingSpinner()" id="params-form-anchor">
                
                {{ base_parameters_form(column_options, form_data) }}
                
                <hr>

                <button type="button" class="btn btn-secondary btn-sm" onclick="toggleAdvancedParams()">
                    Advanced Parameters &raquo;
                </button>

                <!-- ADVANCED PARAMETERS (START) -->
                <div id="advanced-params" class="hidden mt-3 border rounded p-3 bg-light">
                    <h5 class="mb-3">Advanced NCA Parameters</h5>
                    
                    <div class="row g-3">
                        <!-- init -->
                        <div class="col-md-6">
                            <label for="init" class="form-label">Initialization Method:</label>
                            <select id="init" name="init" class="form-select">
                                <option value="auto" {% if form_data.get('init', 'auto') == 'auto' %}selected{% endif %}>Auto</option>
                                <option value="pca" {% if form_data.get('init') == 'pca' %}selected{% endif %}>PCA</option>
                                <option value="lda" {% if form_data.get('init') == 'lda' %}selected{% endif %}>LDA</option>
                                <option value="identity" {% if form_data.get('init') == 'identity' %}selected{% endif %}>Identity</option>
                                <option value="random" {% if form_data.get('init') == 'random' %}selected{% endif %}>Random</option>
                            </select>
                        </div>
                        <!-- max_iter -->
                        <div class="col-md-6">
                            <label for="max_iter" class="form-label">Max Iterations:</label>
                            <input type="number" class="form-control" id="max_iter" name="max_iter" value="{{ form_data.get('max_iter', '50') }}">
                        </div>
                        <!-- tol -->
                        <div class="col-md-6">
                            <label for="tol" class="form-label">Tolerance (optional):</label>
                            <input type="text" class="form-control" id="tol" name="tol" value="{{ form_data.get('tol', '1e-5') }}">
                        </div>
                        <!-- random_state -->
                        <div class="col-md-6">
                            <label for="random_state" class="form-label">Random State (optional):</label>
                            <input type="number" class="form-control" id="random_state" name="random_state" value="{{ form_data.get('random_state', '') }}" placeholder="e.g., 42">
                        </div>
                    </div>
                </div>

                <hr>
                <!-- ADVANCED PARAMETERS (END) -->

                

                <button type="submit" id="run-button" class="btn btn-primary">Run NCA</button>

                {% if param_error %}
                    <div class="alert alert-danger mt-3" role="alert">
                        {{ param_error }}
                    </div>
                {% endif %}
            </form>

            <div id="loading-spinner" class="spinner hidden"></div>
        </div>
    </div>

    {% include '_results_section.html' %}

    {% if scroll_to_results %}
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            scrollToElement('results-anchor');
        });
    </script>
    {% endif %}

    {% if scroll_to_params %}
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            scrollToElement('params-form-anchor');
        });
    </script>
    {% endif %}

{% endblock %}